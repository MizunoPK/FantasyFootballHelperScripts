# Research Notes: Feature 03 (player_data_fetcher_logging)

**Created:** 2026-02-06
**Feature:** Feature 03 - player_data_fetcher_logging
**Research Phase:** S2.P1.I1 (Discovery)

---

## Code Locations

### Entry Point (Subprocess Wrapper)
**File:** `run_player_fetcher.py` (project root)
- **Lines 36-39:** subprocess.run() call
- **Current behavior:** Runs `player_data_fetcher_main.py` without forwarding CLI arguments
- **Modification needed:** Add --enable-log-file argument, forward via sys.argv[1:]

### Main Module
**File:** `player-data-fetcher/player_data_fetcher_main.py`
- **Line 26:** Import setup_logger: `from utils.LoggingManager import setup_logger, get_logger`
- **Line 540:** Setup logger: `logger = setup_logger(LOG_NAME, LOGGING_LEVEL, LOGGING_TO_FILE, LOGGING_FILE, LOGGING_FORMAT)`
- **Line 115:** NFLProjectionsCollector uses: `self.logger = get_logger()`
- **Modification needed:** Add argparse for --enable-log-file, wire to setup_logger()

### Configuration
**File:** `player-data-fetcher/config.py`
- **Lines 48-56:** Logging configuration constants
  - `LOGGING_LEVEL = 'INFO'`
  - `LOGGING_TO_FILE = False` (file logging OFF by default)
  - `LOG_NAME = "player_data_fetcher"`
  - `LOGGING_FILE = './data/log.txt'` (old path, replaced by Feature 01)
  - `LOGGING_FORMAT = 'standard'`

### Modules with Logging (logger.debug/info/warning/error found)
1. **espn_client.py** - ESPN API client, uses `get_logger()` at line 68
2. **player_data_exporter.py** - Data export logic
3. **player_data_fetcher_main.py** - Main entry point
4. **game_data_fetcher.py** - Game data fetching
5. **coordinates_manager.py** - Stadium coordinates
6. **fantasy_points_calculator.py** - Fantasy points calculations
7. **progress_tracker.py** - Progress tracking

---

## Integration with Feature 01

### Feature 01 Provides (from spec.md)
- **LineBasedRotatingHandler:** Custom logging handler with 500-line rotation
- **Modified setup_logger():** Same signature, uses LineBasedRotatingHandler when log_to_file=True
- **logs/ folder structure:** Centralized logs/{script_name}/ folders
- **Timestamped filenames:** {script_name}-{YYYYMMDD_HHMMSS}.log

### Integration Contracts (must follow)
1. **Logger name = folder name:** Use "player_data_fetcher" consistently
2. **log_file_path=None:** Let LoggingManager auto-generate path (don't use config.py LOGGING_FILE)
3. **log_to_file from CLI:** Wire --enable-log-file flag to log_to_file parameter

### Expected Result
```python
# After Feature 03 implementation:
logger = setup_logger(
    name="player_data_fetcher",  # Becomes logs/player_data_fetcher/ folder
    level="INFO",                 # From config or CLI
    log_to_file=args.enable_log_file,  # From CLI flag (default False)
    log_file_path=None,          # Auto-generated by LoggingManager
    log_format="standard"         # From config
)
# Creates: logs/player_data_fetcher/player_data_fetcher-20260206_143522.log
```

---

## Subprocess Wrapper Pattern

### Current Implementation (run_player_fetcher.py)
```python
result = subprocess.run([
    sys.executable,                    # Python interpreter
    "player_data_fetcher_main.py"      # Main script
], check=True)
```

**Problem:** CLI arguments are NOT forwarded to player_data_fetcher_main.py

### Required Modification
```python
# Add argparse to wrapper
parser = argparse.ArgumentParser()
parser.add_argument('--enable-log-file', action='store_true',
                    help='Enable file logging')
args, unknown_args = parser.parse_known_args()

# Forward ALL arguments to subprocess
result = subprocess.run([
    sys.executable,
    "player_data_fetcher_main.py"
] + sys.argv[1:], check=True)  # Forward sys.argv[1:]
```

**Rationale:** Subprocess wrappers must forward all CLI arguments to main script

**Reference:** Discovery Iteration 5 (subprocess wrapper forwarding via sys.argv[1:])

---

## Log Quality Criteria

### DEBUG Level (from Discovery Iteration 3)
- ✅ Function entry/exit with parameters (only for complex flows, not every function)
- ✅ Data transformations with before/after values
- ✅ Conditional branch taken (which if/else path executed)
- ❌ NOT every variable assignment
- ❌ NOT logging inside tight loops without throttling

### INFO Level (from Discovery Iteration 3)
- ✅ Script start/complete with configuration
- ✅ Major phase transitions (e.g., "Starting player data fetch")
- ✅ Significant outcomes (e.g., "Fetched 150 players")
- ❌ NOT implementation details (that's DEBUG)
- ❌ NOT every function call

---

## Test Files to Update

### Test Files (search needed)
- Search pattern: `tests/player-data-fetcher/`
- Likely files: `test_player_data_fetcher_main.py`, `test_espn_client.py`, etc.
- **Update needed:** Log assertions if they check handler type or file paths

### Test Update Strategy
- Run existing tests FIRST to identify failures
- Update assertions to expect LineBasedRotatingHandler (if checked)
- Update log file path assertions (if checked)
- Most tests likely don't assert on logger internals (low impact)

---

## Backward Compatibility

### No Breaking Changes Expected
- setup_logger() signature unchanged (Feature 01 maintains backward compatibility)
- CLI flag is OPTIONAL (default False = no file logging)
- Console logging unaffected
- Existing behavior preserved when flag not used

### Migration Path
- Old: `python run_player_fetcher.py` → console logging only (unchanged)
- New: `python run_player_fetcher.py --enable-log-file` → file logging enabled

---

## Open Questions

{To be populated during research if any gaps found}

No open questions currently.

---

## Implementation Complexity Assessment

**Overall Size:** SMALL-MEDIUM (as estimated in Discovery)

**Components to Modify:**
1. run_player_fetcher.py (5-10 lines - add argparse, forward sys.argv[1:])
2. player_data_fetcher_main.py (10-15 lines - add argparse, wire flag to setup_logger)
3. Log quality improvements (20-30 lines across 7 modules - improve existing debug/info calls)
4. Test updates (5-10 lines if needed - update assertions)

**No New Files Needed:** All modifications to existing files

---

## Key Decisions

{To be populated during spec creation and user approval}

---

## Notes

- Similar pattern to league_helper (subprocess wrapper with sys.argv forwarding)
- Feature 01 dependency COMPLETE ✅ (can reference spec for integration details)
- No external API compatibility concerns (all internal code)
