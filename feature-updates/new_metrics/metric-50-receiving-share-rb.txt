Feature Request: Receiving Share (RB) Metric

**WHAT THIS METRIC IS:**
Receiving Share for RBs measures the running back's receptions as a percentage of their team's total RB corps receptions, and classifies their receiving role (Pass-Catching, Hybrid, Rush-First, Pure Rusher).

**WHAT WE'RE TRYING TO ACCOMPLISH:**
- **Identify elite PPR RBs**: Pass-catching backs (Austin Ekeler, Christian McCaffrey) score more points per touch in PPR leagues (1 point per catch + yardage)
- **Distinguish RB archetypes**: Ekeler-types (70%+ receiving share among RBs) vs Derrick Henry-types (<20% receiving share)
- **Project league format value**: Pass-catchers have 2-3 point higher PPR floor per game than pure rushers
- **Handcuff strategy**: If starter is pass-catching RB, backup may not inherit receiving work (committee risk)
- **Example**: In PPR, an RB with 5 catches for 40 yards (9 points) + 50 rush yards (5 points) = 14 points. Same total yards but pure rusher (90 yards, 0 catches) = 9 points. The 5-catch difference = 5 extra PPR points.

---

**DATA SOURCE UPDATE (2025-12-22)**: ✅ ESPN API PROVIDES TARGETS via stat_58 (see Metric 01).

Position Applicability: RB (Running Back)
Priority: HIGH
Data Source: Calculated from Metric 1 (Target Volume from ESPN API stat_58) + ESPN team passing attempts
Dependency: Requires Metric 1 (Target Volume) implementation
Reference: See `docs/espn/reference/stat_ids.md` for stat_58 documentation

## 1. Player Data Fetcher Updates

NO new data fetching required beyond Metric 1. This is a CALCULATION metric.

**Data Source**: Calculated from Metric 1 + ESPN team stats
- RB targets: From Metric 1 (Target Volume from ESPN API stat_58)
- **IMPORTANT**: ESPN API DOES provide target data via stat_58 (confirmed 2025-12-22)
- Team passing attempts: Available from ESPN API team statistics endpoint OR passing stat IDs
- See `ESPN_API_PROJECT_SUMMARY.md` for complete stat ID verification details

Formula:
```python
rb_target_share = (rb_targets / team_passing_attempts) * 100

# Example - Austin Ekeler (2022):
# Targets: 108 out of ~550 team pass attempts = 19.6% (elite receiving RB)

# Traditional RB:
# Targets: 30 out of ~550 team pass attempts = 5.5% (limited receiving role)
```

No new columns needed (reuse targets from Metric 1).

Team passing attempts data source:
- ESPN API team statistics endpoint: https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams/{team_id}/statistics
- Contains team passing statistics including attempts/completions
- Likely stat name: "passingAttempts" or "completions" in passing category
- May need to verify exact stat name via API exploration

## 2. Data Manager Updates (league_helper)

PlayerManager updates:
- Add calculate_rb_receiving_share(rb_player: FantasyPlayer) -> float method
  - Get RB targets from Metric 1 data
  - Get team passing attempts from TeamDataManager
  - Return target_share percentage (0.0-100.0)

TeamDataManager updates:
- Add get_team_passing_attempts(team_code: str, week: int) -> int method
  - Load team passing attempts from ESPN team stats
  - Used to calculate RB target share denominator

Error handling:
- Missing team passing attempts: Default to league average (550 attempts/season)
- Zero passing attempts: Default to 0.0% target share
- RB has no targets: 0.0% target share (not NULL)

## 3. Config File Updates

Add RECEIVING_SHARE_SCORING to weekX-X.json files:

{
  "RECEIVING_SHARE_SCORING": {
    "THRESHOLDS": {
      "BASE_POSITION": 0.0,
      "DIRECTION": "INCREASING",
      "STEPS": 0.05
    },
    "MULTIPLIERS": {
      "VERY_POOR": 0.95,      // <5% share (limited receiving)
      "POOR": 0.975,          // 5-10% share (moderate receiving)
      "GOOD": 1.025,          // 10-15% share (strong receiving role)
      "EXCELLENT": 1.05       // 15%+ share (elite receiving RB)
    },
    "WEIGHT": 2.0,
    "MIN_WEEKS": 3
  }
}

## 4. Score Player Method Updates

Integration into PlayerManager.score_player():

Step location: Add as new scoring step (Step 19: Receiving Share Multiplier - RB Only)

Formula: STRAIGHT MULTIPLIER (Pattern 1)
score = score * multiplier

Note: multiplier returned from ConfigManager already has WEIGHT exponent applied (multiplier^WEIGHT)

Calculation steps:
1. Load RB's receiving_share from players.csv
2. Apply position-specific logic:
   - RB: Weight receiving share for PPR value
   - WR/TE/QB/K/DST: Skip

3. Get weighted multiplier and apply to score:

```python
def calculate_rb_receiving_share_multiplier(self, player: FantasyPlayer) -> Tuple[float, str]:
    # Only apply to RBs
    if player.position != 'RB':
        return 1.0, "N/A"

    # Get RB targets (from Metric 1)
    rb_targets = player.targets

    # Get team passing attempts
    team_pass_attempts = self.team_data_manager.get_team_passing_attempts(
        player.team, self.current_week
    )

    # Calculate receiving share
    if team_pass_attempts > 0:
        receiving_share_pct = (rb_targets / team_pass_attempts) * 100
    else:
        receiving_share_pct = 0.0

    # ConfigManager returns multiplier already weighted: base_multiplier ^ WEIGHT
    multiplier, rating = self.config.get_receiving_share_multiplier(receiving_share_pct)
    return multiplier, rating

# Apply to score (multiplier already has WEIGHT applied)
multiplier, rating = self.calculate_rb_receiving_share_multiplier(player)
player_score = player_score * multiplier
reason = f"Receiving Share ({rating}): {receiving_share_pct:.1f}%"
```

Position-specific logic:
- RB: Receiving share is critical for PPR (weight = 2.0)
- All others: Skip

## 5. Accuracy Simulation Integration

Simulation validation:
1. NO new columns needed (reuse targets from Metric 1)
2. Add team_passing_attempts to simulation/sim_data/{YEAR}/team_stats.csv
3. For week N simulation:
   - Calculate RB receiving share from Metric 1 targets
   - Use team passing attempts from team_stats.csv

Historical data:
- Reuse Metric 1's target data (already has RB targets)
- Add team passing attempts from ESPN team stats or PFR

Validation metrics:
- Measure RB projection accuracy before/after receiving share integration
- Expected improvement: 15-20% for pass-catching RBs in PPR
- Compare elite receiving RBs (Ekeler) vs traditional RBs (Derrick Henry)
- Validate PPR weight boost (receiving RBs should score higher in PPR)

Special considerations:
- Traditional RBs: Limited receiving share (<5%), minimal impact
- Pass-catching RBs: High receiving share (15%+), major boost in PPR
- Bye weeks: 0 targets, 0% share (not NULL)
- Backup RBs: Often have low snap % but high receiving share (3rd down backs)

Example impact (PPR league):
```
Austin Ekeler (LAC, 19.6% receiving share):
- Base projection: 15.0 points
- Receiving share multiplier: 1.05 (excellent)
- Weight: 2.5
- Adjusted projection: 15.0 * (1.05 ^ 2.5) = 17.0 points

Derrick Henry (TEN, 4.5% receiving share):
- Base projection: 16.0 points
- Receiving share multiplier: 0.95 (very poor)
- Weight: 2.5
- Adjusted projection: 16.0 * (0.95 ^ 2.5) = 14.2 points
```

### Historical Data Compilation (compile_historical_data.py)

**Purpose:** Backfill historical data for simulation validation

**Dependency:** This metric requires Metric 01 (Target Volume) to be compiled first

**New columns to add to weekly snapshot CSV files:**
- `rb_receiving_share` (float): RB targets / team passing attempts (0.00-1.00)
- `team_passing_attempts` (int): Team total passing attempts for week

**Data source for historical backfill:**
- RB targets: From Metric 01 (Target Volume from Pro Football Reference)
- Team passing attempts: ESPN API team stats OR Pro Football Reference team game logs
  - ESPN: Team statistics endpoint (preferred if available)
  - PFR: Team game logs as fallback (scraping required)
- Calculation: (RB targets from Metric 01) / (team passing attempts) * 100
- Time period: 2021, 2022, 2024 seasons (17 weeks each = 51 weeks total)

**Script updates needed:**

1. **Add data fetcher for team passing attempts:**
   ```python
   def fetch_team_passing_attempts_historical_data(year: int, week: int) -> pd.DataFrame:
       """
       Fetch historical team passing attempts for given year/week.

       Args:
           year: NFL season year (2021, 2022, 2024)
           week: NFL week number (1-17)

       Returns:
           DataFrame with columns: team_code, passing_attempts
       """
       # Fetch team stats from ESPN API or PFR
       # Extract passing attempts for each team in that week
       # Return team -> passing_attempts mapping
       pass
   ```

2. **Add RB receiving share calculator:**
   ```python
   def calculate_rb_receiving_share(players_df: pd.DataFrame, team_pass_attempts_df: pd.DataFrame) -> pd.DataFrame:
       """Calculate RB receiving share from targets and team passing attempts."""
       # Merge team passing attempts into players_df
       players_df = players_df.merge(
           team_pass_attempts_df,
           left_on='team',
           right_on='team_code',
           how='left'
       )

       # Calculate receiving share for RBs only
       def calc_share(row):
           if row['position'] != 'RB':
               return 0.0

           targets = row.get('targets', 0)
           team_pass_att = row.get('passing_attempts', 0)

           if team_pass_att > 0:
               return (targets / team_pass_att) * 100
           else:
               return 0.0

       players_df['rb_receiving_share'] = players_df.apply(calc_share, axis=1)
       return players_df
   ```

3. **Add column merger:**
   ```python
   def merge_rb_receiving_share_data(players_df: pd.DataFrame, team_pass_df: pd.DataFrame) -> pd.DataFrame:
       """Merge RB receiving share data into weekly snapshot."""
       return calculate_rb_receiving_share(players_df, team_pass_df)
   ```

4. **Update main compilation loop:**
   ```python
   # In compile_historical_data.py main loop
   # NOTE: This MUST run AFTER Metric 01 (Target Volume) compilation
   for year in [2021, 2022, 2024]:
       for week in range(1, 18):
           players_df = load_weekly_snapshot(year, week)

           # Verify targets column exists (from Metric 01)
           if 'targets' not in players_df.columns:
               raise ValueError(f"Metric 01 must be compiled before Metric 50 for {year} week {week}")

           # Fetch team passing attempts
           team_pass_attempts = fetch_team_passing_attempts_historical_data(year, week)

           # Calculate RB receiving share
           players_df = merge_rb_receiving_share_data(players_df, team_pass_attempts)

           save_weekly_snapshot(year, week, players_df)
   ```

**Validation:**
- Verify all 51 weeks (17 weeks × 3 seasons) have complete RB receiving share data
- Check for missing values: NULL only if team passing attempts unavailable, 0.0 for non-RBs
- Validate data ranges:
  - rb_receiving_share: 0.0-25.0 (percentage, elite receiving RBs like Ekeler may reach 20%+)
  - team_passing_attempts: 20-60 typical (weather games may be lower)
- Cross-check calculation:
  - Sample RB: 8 targets, team 40 attempts → receiving_share = (8/40)*100 = 20.0% ✓
  - Validate position filter: Only RBs should have non-zero rb_receiving_share
- Compare elite vs traditional RBs:
  - Austin Ekeler (2022): ~19% receiving share (elite)
  - Derrick Henry (2022): ~4% receiving share (traditional)
- Validate PPR impact: Higher receiving share should correlate with higher PPR value

**Estimated time:** 3-4 hours for 51 weeks of data across 3 seasons (team stats fetching + calculation)

Implementation blockers: Requires Metric 1 (Target Volume) implementation first
Dependencies: Metric 1 (Target Volume), team passing attempts data
Estimated effort: 1-2 hours (calculation only, once Metric 1 is available)
