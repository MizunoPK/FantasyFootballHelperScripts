Feature Request: Scramble Tendency (QB) Metric

**WHAT THIS METRIC IS:**
Scramble Tendency classifies quarterbacks by their rushing production into mobility tiers (Elite Rusher, Mobile, Pocket Passer, Pure Passer). It measures rushing yards per game and identifies dual-threat QBs who add significant fantasy value through rushing.

**WHAT WE'RE TRYING TO ACCOMPLISH:**
- **Identify dual-threat QBs**: Elite rushers (Lamar Jackson, Jalen Hurts, Josh Allen) gain 40-60 rush yards/game, adding 4-6 points per week
- **Quantify rushing floor/ceiling**: Mobile QBs have higher fantasy floors (rushing yards are more consistent than passing TDs)
- **Rushing TD value**: QB rushing TDs worth 6 points vs 4 for passing TDs, and require fewer yards (10 rush yards + TD = 7 points vs need 40 pass yards + TD for same)
- **Injury risk awareness**: Elite rushers have higher injury risk but also higher weekly ceiling
- **Draft strategy**: Dual-threat QBs (Tier 1) should be prioritized over pure passers (Tier 3-4) even with similar passing stats
- **Example**: Lamar Jackson averaging 250 pass yards + 1 pass TD + 60 rush yards + 0.5 rush TDs = ~23 points. Tom Brady with 300 pass yards + 2 pass TDs + 2 rush yards = ~20 points. The rushing adds 3+ points per week.

---

**DATA SOURCE UPDATE (2025-12-22)**: ✅ ESPN API PROVIDES COMPLETE QB RUSHING STATS (comprehensive testing completed).

Position Applicability: QB
Priority: MEDIUM
Data Source: ESPN API (QB rushing stats via stat_23, stat_24, stat_25) - existing data
Reference: See `docs/espn/reference/stat_ids.md` for complete QB rushing stat documentation

## 1. Player Data Fetcher Updates

NO new data fetching required. This metric uses EXISTING ESPN API data.

**COMPREHENSIVE ESPN API STAT ID MAPPING (2025-12-22)**:

**All QB Rushing Stats Verified** (30/146 stat IDs confirmed):
- `stat_23` = Rushing Attempts/Carries (Raw) - **CONFIRMED** (100% validation)
- `stat_24` = Rushing Yards (Raw) - **CONFIRMED**
- `stat_25` = Rushing TDs (Raw) - **CONFIRMED**
- `stat_39` = Yards Per Carry (Calculated) - Formula: stat_24 / stat_23

**Verification Details:**
- Cross-referenced with NFL.com official box scores
- Tested mobile QBs (Josh Allen, Jalen Hurts) across weeks 1, 8, 15, 17 (2024 season)
- Confidence: CONFIRMED (95-100% validation rate)
- See `ESPN_API_PROJECT_SUMMARY.md` for complete methodology

**Data Source**: Calculated from existing QB rushing stats in players.csv
- QB rushing attempts: ESPN API stat_23 (**CONFIRMED**, was previously uncertain)
- QB rushing yards: ESPN API stat_24 (**CONFIRMED**, not stat_20)
- QB rushing TDs: ESPN API stat_25 (**CONFIRMED**)
- ESPN API provides all rushing stats via verified stat IDs
- Calculation: Average rushing attempts per game from stat_23 weekly data

QB rushing data already available in existing ESPN API data:
- QB rushing attempts: Likely in players.csv stats (stat ID needs verification)
- QB rushing yards: Already in players.csv stats (stat ID 20, confirmed)
- Mobile QBs (Lamar Jackson, Jalen Hurts) score significantly more via rushing

Fallback if rushing attempts stat ID unavailable:
- Use rushing yards as proxy metric
- Elite mobile QBs: 40+ rush yards/game
- Mobile QBs: 20-40 rush yards/game
- Pocket passers: <10 rush yards/game

## 2. Data Manager Updates (league_helper)

PlayerManager updates:
- Add get_qb_rush_attempts_per_game(qb: FantasyPlayer) -> float method
  - Calculate average rush attempts per game from weekly data
  - Identify mobile QBs (8+ attempts/game) vs pocket passers (<3 attempts/game)

- Add get_qb_scramble_multiplier(rush_attempts_per_game: float) -> float method
  - Convert rush attempts to multiplier
  - Higher attempts = higher fantasy value (rushing TDs + yards)

Error handling:
- Missing rushing data: Default to 0.0 attempts (pocket passer)
- Non-QB positions: Return 1.0 (neutral, skip metric)

## 3. Config File Updates

Add SCRAMBLE_TENDENCY_SCORING to weekX-X.json files:

{
  "SCRAMBLE_TENDENCY_SCORING": {
    "THRESHOLDS": {
      "BASE_POSITION": 0,
      "DIRECTION": "INCREASING",
      "STEPS": 3
    },
    "MULTIPLIERS": {
      "VERY_POOR": 0.95,      // <3 rush attempts/game (pocket passer)
      "POOR": 0.975,          // 3-5 attempts (occasionally mobile)
      "GOOD": 1.025,          // 5-8 attempts (mobile)
      "EXCELLENT": 1.05       // 8+ attempts (elite mobile QB)
    },
    "WEIGHT": 1.8,
    "MIN_WEEKS": 3
  }
}

## 4. Score Player Method Updates

Integration into PlayerManager.score_player():

Step location: Add as new scoring step (Step 14: Scramble Tendency Multiplier)

Formula: STRAIGHT MULTIPLIER (Pattern 1)
score = score * multiplier

Note: multiplier returned from ConfigManager already has WEIGHT exponent applied (multiplier^WEIGHT)

Calculation steps:
1. Load player's scrambles_per_game from players.csv
2. Apply position-specific logic:
   - QB: Weight scramble tendency (mobile QBs have higher floor)
   - WR/TE/RB/K/DST: Skip

3. Get weighted multiplier and apply to score:

```python
def calculate_scramble_tendency_multiplier(self, player: FantasyPlayer) -> Tuple[float, str]:
    if player.position != 'QB':
        return 1.0, "N/A"

    # Get QB rush attempts per game from existing stats
    rush_attempts_per_game = self.get_qb_rush_attempts_per_game(player)

    # ConfigManager returns multiplier already weighted: base_multiplier ^ WEIGHT
    multiplier, rating = self.config.get_scramble_tendency_multiplier(rush_attempts_per_game)
    return multiplier, rating

# Apply to score (multiplier already has WEIGHT applied)
multiplier, rating = self.calculate_scramble_tendency_multiplier(player)
player_score = player_score * multiplier
reason = f"Scramble Tendency ({rating}): {rush_attempts_per_game:.1f} rushes/game"
```

Position-specific logic:
- QB: Mobile QBs (5+ rushes/game) get significant boost
- All others: Skip

## 5. Accuracy Simulation Integration

Validation:
- NO new columns needed (uses existing rushing stats)
- Calculate rush attempts per game from weekly rushing data

Historical validation:
```python
# For week N simulation:
# Calculate QB rush attempts per game from weeks 1 to N-1
rush_attempts_avg = sum(rush_attempts_weeks_1_to_N-1) / (N-1)

# Apply scramble multiplier to QB projections for weeks N to 17
```

Validation metrics:
- Measure QB projection accuracy before/after scramble tendency integration
- Expected improvement: 12-18% for mobile QBs
- Compare mobile QBs (Lamar) vs pocket passers (Brady)
- Validate rushing value (rushing TDs worth 6 points, huge impact)

Example impact:
```
Lamar Jackson (BAL, 9.2 rush attempts/game):
- Base projection: 22.0 points
- Scramble multiplier: 1.05 (elite mobile)
- Weight: 2.0
- Adjusted: 22.0 * (1.05 ^ 2.0) = 24.3 points

Tom Brady (TB, 0.8 rush attempts/game):
- Base projection: 20.0 points
- Scramble multiplier: 0.95 (pocket passer)
- Weight: 2.0
- Adjusted: 20.0 * (0.95 ^ 2.0) = 18.0 points
```

### Historical Data Compilation (compile_historical_data.py)

**Purpose:** Backfill historical data for simulation validation

**New columns to add to weekly snapshot CSV files:**
- `qb_rush_attempts_per_game` (float): Average QB rushing attempts per game (0.0-12.0 typical)
- `qb_scramble_tendency_category` (string): "elite_mobile", "mobile", "occasionally_mobile", "pocket_passer"

**Data source for historical backfill:**
- **Pure calculation** from existing QB rushing stats (week_1_rush_att through week_17_rush_att)
- **No external data fetching required** - rushing stats already in weekly snapshots from ESPN API
- ESPN API provides rushing yards (stat ID 20) and likely rushing attempts
- If rushing attempts unavailable, use rushing yards as proxy
- Time period: 2021, 2022, 2024 seasons (17 weeks each)

**Script updates needed:**

1. **Add QB scramble tendency calculator:**
   ```python
   def calculate_qb_scramble_tendency(players_df: pd.DataFrame, current_week: int) -> pd.DataFrame:
       """
       Calculate QB scramble tendency from historical rushing attempts.

       Args:
           players_df: DataFrame with weekly rushing attempt columns
           current_week: Week number to calculate up to (1-17)

       Returns:
           DataFrame with added qb_rush_attempts_per_game column
       """
       def calc_rush_avg(row):
           if row['position'] != 'QB':
               return 0.0

           # Get rushing attempts from weeks 1 to current_week
           rush_cols = [f'week_{w}_rush_att' for w in range(1, current_week + 1)]
           rush_attempts = [row.get(col, 0) for col in rush_cols if col in row]
           valid_attempts = [att for att in rush_attempts if pd.notna(att)]

           if len(valid_attempts) > 0:
               return sum(valid_attempts) / len(valid_attempts)
           else:
               return 0.0

       def categorize_scramble_tendency(rush_avg):
           if rush_avg >= 8.0:
               return "elite_mobile"  # Lamar Jackson, Jalen Hurts
           elif rush_avg >= 5.0:
               return "mobile"  # Josh Allen, Kyler Murray
           elif rush_avg >= 3.0:
               return "occasionally_mobile"  # Patrick Mahomes
           else:
               return "pocket_passer"  # Tom Brady, Joe Burrow

       players_df['qb_rush_attempts_per_game'] = players_df.apply(calc_rush_avg, axis=1)
       players_df['qb_scramble_tendency_category'] = players_df['qb_rush_attempts_per_game'].apply(categorize_scramble_tendency)

       return players_df
   ```

2. **Add column merger:**
   ```python
   def merge_qb_scramble_tendency_data(players_df: pd.DataFrame, current_week: int) -> pd.DataFrame:
       """Calculate and add QB scramble tendency columns."""
       return calculate_qb_scramble_tendency(players_df, current_week)
   ```

3. **Update main compilation loop:**
   ```python
   # In compile_historical_data.py main loop
   for year in [2021, 2022, 2024]:
       for week in range(1, 18):
           players_df = load_weekly_snapshot(year, week)

           # Verify weekly rushing attempt columns exist
           # Need week_{1-17}_rush_att columns (should already exist in snapshots)
           required_cols = [f'week_{w}_rush_att' for w in range(1, week + 1)]
           if not all(col in players_df.columns for col in required_cols):
               raise ValueError(f"Weekly rushing attempt columns missing for {year} week {week}")

           # Calculate QB scramble tendency
           players_df = merge_qb_scramble_tendency_data(players_df, week)

           save_weekly_snapshot(year, week, players_df)
   ```

**Validation:**
- Verify all 51 weeks (17 weeks × 3 seasons) have qb_rush_attempts_per_game calculated
- Check for missing values: 0.0 for non-QBs, calculated average for QBs
- Validate data ranges:
  - qb_rush_attempts_per_game: 0.0-12.0 (Lamar Jackson peaks around 9-10)
  - Pocket passers: 0.0-2.0
  - Mobile QBs: 5.0-8.0
  - Elite mobile: 8.0+
- Cross-check known QBs:
  - Lamar Jackson (2021): ~9.5 attempts/game → elite_mobile ✓
  - Josh Allen (2021): ~6.2 attempts/game → mobile ✓
  - Tom Brady (2021): ~0.8 attempts/game → pocket_passer ✓
- Validate category assignment: Confirm thresholds match QB archetypes
- Check week-to-week consistency: Mobile QBs should maintain tendency across season

**Estimated time:** 1 hour for calculation integration (simple average from existing data)

Implementation blockers: None
Dependencies: None (uses existing rushing stats)
Estimated effort: 1-2 hours (calculation from existing data)
