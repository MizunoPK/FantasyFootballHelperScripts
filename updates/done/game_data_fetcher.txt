# Game Data Fetcher - Update Specification

## Objective
Update the player data fetcher to create a new file called `game_data.csv` alongside the existing data files (players.csv, players_projected.csv, and team_data/). This file will contain game-level data from the ESPN API and Open-Meteo API that is useful for predicting player performance.

## Background
Based on the ESPN API research documented in:
- `docs/research/ESPN_NFL_Game_Data_Research_Report.md`
- `docs/research/ESPN_API_Predictive_Fields_Report.md`

We have verified that:
- ESPN API provides game-level data including venue information and game scores
- ESPN API does NOT provide weather for completed games
- Open-Meteo API provides FREE historical weather data back to 1940

**Decision**: Always use Open-Meteo for weather data (both future and past games) to ensure consistency.

## Data Sources
- **ESPN Scoreboard API**: `https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard`
  - Query params: `seasontype=2`, `week={week}`, `dates={season}`
  - Provides: teams, scores, venue info, indoor flag, neutral site, date
- **Open-Meteo Historical API**: `https://archive-api.open-meteo.com/v1/archive`
  - Provides: temperature, wind gusts, precipitation (for ALL games, past and future)
  - No API key required, free tier 10,000 calls/day

## Output File
- **File Name**: `game_data.csv`
- **Location**: `data/game_data.csv` (shared data folder, same as players.csv)
- **Historical Data**: Save to `data/historical_data/{Season}/{WeekNumber}/game_data.csv` following existing pattern

## CSV Columns
The game_data.csv file should have the following columns:

| Column Name | Type | Description | Source | Notes |
|------------|------|-------------|--------|-------|
| `week` | int | NFL week number (1-18) | ESPN Scoreboard | Required |
| `home_team` | str | Home team abbreviation | ESPN Scoreboard | e.g., "DET" |
| `away_team` | str | Away team abbreviation | ESPN Scoreboard | e.g., "GB" |
| `temperature` | int or None | Temperature in Fahrenheit | Open-Meteo | None for indoor games |
| `gust` | int or None | Wind gust speed in mph | Open-Meteo | None for indoor games |
| `precipitation` | float or None | Precipitation amount (inches) | Open-Meteo | None for indoor games |
| `home_team_score` | int or None | Home team final score | ESPN Scoreboard | None for future games |
| `away_team_score` | int or None | Away team final score | ESPN Scoreboard | None for future games |
| `indoor` | bool | Whether stadium is indoor | ESPN Scoreboard | True/False |
| `neutral_site` | bool | Whether game is at neutral site | ESPN Scoreboard | True for international games |
| `country` | str | Country of venue | ESPN Scoreboard | "USA", "Brazil", "England", etc. |
| `city` | str | City of venue | ESPN Scoreboard | e.g., "Detroit" |
| `state` | str or None | State of venue (USA only) | ESPN Scoreboard | None for international games |
| `date` | str | Game date in ISO 8601 format | ESPN Scoreboard | e.g., "2025-11-27T17:30Z" |

## Stadium Coordinates System

The fetcher needs stadium coordinates to query Open-Meteo. Instead of hardcoding coordinates, use a dynamic JSON file that can be extended as new venues are encountered.

### Coordinates File
- **File**: `player-data-fetcher/coordinates.json`
- **Purpose**: Store coordinates for all game venues (NFL stadiums + international venues)
- **Behavior**:
  - Load on startup
  - If a venue is not found, query geocoding API to get coordinates
  - Save new coordinates to file for future use

### File Format
```json
{
  "nfl_stadiums": {
    "BUF": {"lat": 42.7738, "lon": -78.7870, "tz": "America/New_York", "indoor": false, "name": "Highmark Stadium"},
    "MIA": {"lat": 25.9580, "lon": -80.2389, "tz": "America/New_York", "indoor": false, "name": "Hard Rock Stadium"},
    "KC": {"lat": 39.0489, "lon": -94.4839, "tz": "America/Chicago", "indoor": false, "name": "GEHA Field at Arrowhead Stadium"}
  },
  "international_venues": {
    "Sao Paulo,Brazil": {"lat": -23.5454, "lon": -46.4742, "tz": "America/Sao_Paulo", "indoor": false, "name": "Arena Corinthians"},
    "London,England": {"lat": 51.5560, "lon": -0.2795, "tz": "Europe/London", "indoor": false, "name": "Wembley Stadium"}
  }
}
```

### Coordinate Lookup Logic
```python
class CoordinatesManager:
    """Manages stadium coordinates with dynamic lookup and caching."""

    def __init__(self, coordinates_file: Path):
        self.coordinates_file = coordinates_file
        self.data = self._load_coordinates()

    def _load_coordinates(self) -> dict:
        """Load coordinates from JSON file, create if doesn't exist."""
        if self.coordinates_file.exists():
            with open(self.coordinates_file) as f:
                return json.load(f)
        return {"nfl_stadiums": {}, "international_venues": {}}

    def _save_coordinates(self) -> None:
        """Save coordinates to JSON file."""
        with open(self.coordinates_file, 'w') as f:
            json.dump(self.data, f, indent=2)

    def get_nfl_stadium(self, team_abbrev: str) -> Optional[dict]:
        """Get coordinates for an NFL team's home stadium."""
        return self.data["nfl_stadiums"].get(team_abbrev)

    def get_international_venue(self, city: str, country: str) -> Optional[dict]:
        """Get coordinates for an international venue."""
        key = f"{city},{country}"
        return self.data["international_venues"].get(key)

    def get_or_fetch_coordinates(
        self,
        team_abbrev: Optional[str] = None,
        city: Optional[str] = None,
        country: Optional[str] = None,
        is_international: bool = False
    ) -> Optional[dict]:
        """
        Get coordinates from cache or fetch from geocoding API.

        For NFL stadiums: provide team_abbrev
        For international venues: provide city and country, set is_international=True
        """
        if is_international:
            coords = self.get_international_venue(city, country)
            if coords:
                return coords
            # Fetch from geocoding API
            coords = self._fetch_coordinates_from_api(city, country)
            if coords:
                key = f"{city},{country}"
                self.data["international_venues"][key] = coords
                self._save_coordinates()
            return coords
        else:
            coords = self.get_nfl_stadium(team_abbrev)
            if coords:
                return coords
            # NFL stadiums should always be pre-populated
            # But if missing, could potentially look up by team name
            self.logger.warning(f"NFL stadium not found for {team_abbrev}")
            return None

    def _fetch_coordinates_from_api(self, city: str, country: str) -> Optional[dict]:
        """
        Fetch coordinates from Open-Meteo Geocoding API.

        API: https://geocoding-api.open-meteo.com/v1/search
        Free, no API key required.
        """
        params = {
            "name": f"{city}, {country}",
            "count": 1,
            "language": "en",
            "format": "json"
        }

        response = httpx.get(
            "https://geocoding-api.open-meteo.com/v1/search",
            params=params
        )

        if response.status_code != 200:
            self.logger.error(f"Geocoding API error: {response.status_code}")
            return None

        data = response.json()
        if not data.get("results"):
            self.logger.warning(f"No geocoding results for {city}, {country}")
            return None

        result = data["results"][0]
        return {
            "lat": result["latitude"],
            "lon": result["longitude"],
            "tz": result.get("timezone", "UTC"),
            "indoor": False,  # International venues are typically outdoor
            "name": result.get("name", f"{city} Stadium")
        }
```

### Geocoding API (Open-Meteo)
- **Endpoint**: `https://geocoding-api.open-meteo.com/v1/search`
- **Free**: No API key required
- **Parameters**:
  - `name`: Location name (e.g., "Sao Paulo, Brazil")
  - `count`: Number of results (use 1)
  - `language`: "en"
  - `format`: "json"

### Example Geocoding Response
```json
{
  "results": [
    {
      "id": 3448439,
      "name": "São Paulo",
      "latitude": -23.5475,
      "longitude": -46.6361,
      "timezone": "America/Sao_Paulo",
      "country": "Brazil",
      "admin1": "São Paulo"
    }
  ]
}
```

### Initial Coordinates File
The `coordinates.json` file should be pre-populated with all 32 NFL stadiums on first creation. International venues will be added dynamically as games are encountered.

```json
{
  "nfl_stadiums": {
    "ARI": {"lat": 33.5276, "lon": -112.2626, "tz": "America/Phoenix", "indoor": true, "name": "State Farm Stadium"},
    "ATL": {"lat": 33.7553, "lon": -84.4006, "tz": "America/New_York", "indoor": true, "name": "Mercedes-Benz Stadium"},
    "BAL": {"lat": 39.2780, "lon": -76.6227, "tz": "America/New_York", "indoor": false, "name": "M&T Bank Stadium"},
    "BUF": {"lat": 42.7738, "lon": -78.7870, "tz": "America/New_York", "indoor": false, "name": "Highmark Stadium"},
    "CAR": {"lat": 35.2258, "lon": -80.8528, "tz": "America/New_York", "indoor": false, "name": "Bank of America Stadium"},
    "CHI": {"lat": 41.8623, "lon": -87.6167, "tz": "America/Chicago", "indoor": false, "name": "Soldier Field"},
    "CIN": {"lat": 39.0954, "lon": -84.5160, "tz": "America/New_York", "indoor": false, "name": "Paycor Stadium"},
    "CLE": {"lat": 41.5061, "lon": -81.6995, "tz": "America/New_York", "indoor": false, "name": "Cleveland Browns Stadium"},
    "DAL": {"lat": 32.7473, "lon": -97.0945, "tz": "America/Chicago", "indoor": true, "name": "AT&T Stadium"},
    "DEN": {"lat": 39.7439, "lon": -105.0201, "tz": "America/Denver", "indoor": false, "name": "Empower Field at Mile High"},
    "DET": {"lat": 42.3400, "lon": -83.0456, "tz": "America/Detroit", "indoor": true, "name": "Ford Field"},
    "GB": {"lat": 44.5013, "lon": -88.0622, "tz": "America/Chicago", "indoor": false, "name": "Lambeau Field"},
    "HOU": {"lat": 29.6847, "lon": -95.4107, "tz": "America/Chicago", "indoor": true, "name": "NRG Stadium"},
    "IND": {"lat": 39.7601, "lon": -86.1639, "tz": "America/Indiana/Indianapolis", "indoor": true, "name": "Lucas Oil Stadium"},
    "JAX": {"lat": 30.3239, "lon": -81.6373, "tz": "America/New_York", "indoor": false, "name": "EverBank Stadium"},
    "KC": {"lat": 39.0489, "lon": -94.4839, "tz": "America/Chicago", "indoor": false, "name": "GEHA Field at Arrowhead Stadium"},
    "LAC": {"lat": 33.9535, "lon": -118.3392, "tz": "America/Los_Angeles", "indoor": true, "name": "SoFi Stadium"},
    "LAR": {"lat": 33.9535, "lon": -118.3392, "tz": "America/Los_Angeles", "indoor": true, "name": "SoFi Stadium"},
    "LV": {"lat": 36.0909, "lon": -115.1833, "tz": "America/Los_Angeles", "indoor": true, "name": "Allegiant Stadium"},
    "MIA": {"lat": 25.9580, "lon": -80.2389, "tz": "America/New_York", "indoor": false, "name": "Hard Rock Stadium"},
    "MIN": {"lat": 44.9737, "lon": -93.2577, "tz": "America/Chicago", "indoor": true, "name": "U.S. Bank Stadium"},
    "NE": {"lat": 42.0909, "lon": -71.2643, "tz": "America/New_York", "indoor": false, "name": "Gillette Stadium"},
    "NO": {"lat": 29.9511, "lon": -90.0812, "tz": "America/Chicago", "indoor": true, "name": "Caesars Superdome"},
    "NYG": {"lat": 40.8128, "lon": -74.0742, "tz": "America/New_York", "indoor": false, "name": "MetLife Stadium"},
    "NYJ": {"lat": 40.8128, "lon": -74.0742, "tz": "America/New_York", "indoor": false, "name": "MetLife Stadium"},
    "PHI": {"lat": 39.9008, "lon": -75.1675, "tz": "America/New_York", "indoor": false, "name": "Lincoln Financial Field"},
    "PIT": {"lat": 40.4468, "lon": -80.0158, "tz": "America/New_York", "indoor": false, "name": "Acrisure Stadium"},
    "SEA": {"lat": 47.5952, "lon": -122.3316, "tz": "America/Los_Angeles", "indoor": false, "name": "Lumen Field"},
    "SF": {"lat": 37.4033, "lon": -121.9694, "tz": "America/Los_Angeles", "indoor": false, "name": "Levi's Stadium"},
    "TB": {"lat": 27.9759, "lon": -82.5033, "tz": "America/New_York", "indoor": false, "name": "Raymond James Stadium"},
    "TEN": {"lat": 36.1665, "lon": -86.7713, "tz": "America/Chicago", "indoor": false, "name": "Nissan Stadium"},
    "WSH": {"lat": 38.9076, "lon": -76.8645, "tz": "America/New_York", "indoor": false, "name": "Northwest Stadium"}
  },
  "international_venues": {}
}
```

## Behavior Requirements

### 1. File Creation
- If `game_data.csv` does not exist in `data/`, create it with headers
- If it exists, read it to determine which weeks already have data

### 2. Week Detection Logic
```python
# Pseudo-code for determining which weeks to fetch
existing_weeks = set()  # weeks that already have any data in the file
weeks_to_fetch = []

for week in range(1, CURRENT_NFL_WEEK + 1):
    if week not in existing_weeks:
        weeks_to_fetch.append(week)
```

### 3. Score Backfill for Previous Week
When the fetcher runs, it should also check if the previous week's games have scores populated:

```python
# Pseudo-code for score backfill
previous_week = CURRENT_NFL_WEEK - 1

if previous_week >= 1:
    # Find all games from previous week in the CSV
    previous_week_games = get_games_for_week(previous_week)

    for game in previous_week_games:
        if game['home_team_score'] is None or game['away_team_score'] is None:
            # Fetch updated data from ESPN API
            updated_game = fetch_game_from_espn(previous_week, game['home_team'], game['away_team'])

            # Update the scores in the CSV
            game['home_team_score'] = updated_game['home_team_score']
            game['away_team_score'] = updated_game['away_team_score']
```

**Why this is needed**:
- When the fetcher runs during a week, games from the current week are future games with no scores
- The next time it runs (the following week), those games are now completed
- We need to go back and fill in the scores for games that were fetched as "future" but are now "completed"
- Only need to check (CURRENT_NFL_WEEK - 1) since older weeks would have been backfilled in previous runs

### 4. Data Fetching
For each week that needs data:

1. **Fetch ESPN Scoreboard** for that week
2. **For each game** in the scoreboard:
   - Extract basic game info (teams, venue, date, indoor, neutral_site)
   - If game is completed (`status.type.completed == True`):
     - Extract scores (convert from STRING to int)
   - **If outdoor game**, fetch weather from Open-Meteo:
     - Use home team stadium coordinates
     - For international games, use INTERNATIONAL_VENUES coordinates
     - Parse game date to get YYYY-MM-DD format
     - Parse game time to get the hour (UTC, convert to local)
     - Fetch hourly weather and select the game hour
3. Append all games from that week to the CSV

### 5. Weather Fetching Logic (Open-Meteo)
```python
def fetch_weather_for_game(
    coords_manager: CoordinatesManager,
    home_team: str,
    game_date: str,
    is_international: bool,
    city: str,
    country: str
) -> dict:
    """
    Fetch weather from Open-Meteo for a game.

    Args:
        coords_manager: CoordinatesManager instance for coordinate lookups
        home_team: Home team abbreviation (e.g., "KC")
        game_date: ISO 8601 date (e.g., "2024-09-05T00:20Z")
        is_international: True if neutral_site and country != "USA"
        city: City name for international games
        country: Country name for international games

    Returns:
        dict with temperature, gust, precipitation or None values for indoor
    """
    # Get coordinates (will fetch from API if not cached)
    coords = coords_manager.get_or_fetch_coordinates(
        team_abbrev=home_team,
        city=city,
        country=country,
        is_international=is_international
    )

    if not coords:
        return {"temperature": None, "gust": None, "precipitation": None}

    if coords.get("indoor"):
        return {"temperature": None, "gust": None, "precipitation": None}

    # Parse date and time
    date_only = game_date.split('T')[0]  # "2024-09-05"
    game_hour_utc = int(game_date.split('T')[1].split(':')[0])  # 0-23 UTC

    # Fetch from Open-Meteo
    params = {
        "latitude": coords["lat"],
        "longitude": coords["lon"],
        "start_date": date_only,
        "end_date": date_only,
        "hourly": "temperature_2m,wind_gusts_10m,precipitation",
        "temperature_unit": "fahrenheit",
        "wind_speed_unit": "mph",
        "precipitation_unit": "inch",
        "timezone": coords["tz"]
    }

    response = httpx.get("https://archive-api.open-meteo.com/v1/archive", params=params)
    data = response.json()

    # Find the hour that corresponds to game time (already in local time due to timezone param)
    # Note: Need to convert UTC game hour to local time
    hourly = data["hourly"]

    # Simplified: use the UTC hour directly since Open-Meteo returns local time
    # In practice, may need timezone conversion
    hour_index = game_hour_utc  # 0-23

    return {
        "temperature": round(hourly["temperature_2m"][hour_index]),
        "gust": round(hourly["wind_gusts_10m"][hour_index]),
        "precipitation": round(hourly["precipitation"][hour_index], 2)
    }
```

### 6. Handling Missing Data
- **Weather for indoor games**: Set temperature, gust, precipitation to None (empty)
- **Scores for future games**: Scores will be None for scheduled games
- **State for international games**: State will be None when country is not "USA"
- **Open-Meteo data gap**: Recent games (< 5 days old) may not have weather data yet - leave empty

### 7. Historical Data Saving
Follow existing pattern in `save_to_historical_data()`:
- Check if `data/historical_data/{Season}/{WeekNumber}/` exists
- If not, create it and copy `game_data.csv` to that folder
- If it exists, skip (already saved for this week)

## Implementation Location

### New Files
- `player-data-fetcher/game_data_fetcher.py` - Module for fetching game data from ESPN + Open-Meteo
- `player-data-fetcher/game_data_models.py` - Pydantic model for GameData
- `player-data-fetcher/coordinates_manager.py` - CoordinatesManager class for dynamic coordinate lookup
- `player-data-fetcher/coordinates.json` - Pre-populated JSON file with NFL stadium coordinates

### Modified Files
- `player-data-fetcher/player_data_fetcher_main.py` - Add call to game data collection
- `player-data-fetcher/config.py` - Add GAME_DATA_CSV and COORDINATES_JSON constants

## Example Output

```csv
week,home_team,away_team,temperature,gust,precipitation,home_team_score,away_team_score,indoor,neutral_site,country,city,state,date
1,KC,LAC,75,12,0.0,24,21,False,True,Brazil,Sao Paulo,,2025-09-06T00:00Z
1,BAL,BUF,72,15,0.0,27,24,False,False,USA,Baltimore,MD,2025-09-08T17:00Z
1,MIN,NYG,,,,28,6,True,False,USA,Minneapolis,MN,2025-09-08T13:00Z
12,HOU,BUF,,,,23,20,True,False,USA,Houston,TX,2025-11-21T01:15Z
13,DET,GB,,,,,,,True,False,USA,Detroit,MI,2025-11-27T17:30Z
```

Note: Empty values for weather on indoor games, empty scores for future games.

## API Rate Limiting
- **ESPN API**: Use existing `RATE_LIMIT_DELAY` from config.py (0.2s between requests)
- **Open-Meteo API**: No delay needed (10,000 calls/day limit, no API key)

## Testing Requirements
- Add unit tests in `tests/player-data-fetcher/test_game_data_fetcher.py`
- Add unit tests in `tests/player-data-fetcher/test_coordinates_manager.py`
- Test file creation when none exists
- Test week detection logic
- Test score backfill logic
- Test handling of missing data (None values)
- Test Open-Meteo weather integration
- Test indoor game weather skipping
- Test international venue coordinate lookup
- Test historical data saving
- Mock ESPN and Open-Meteo API responses for testing

### CoordinatesManager Tests
- Test loading coordinates from existing JSON file
- Test creating new JSON file when none exists
- Test NFL stadium coordinate lookup (cache hit)
- Test international venue coordinate lookup (cache hit)
- Test geocoding API fallback for unknown venues
- Test saving new coordinates to JSON file after API lookup
- Test handling geocoding API errors gracefully
- Test handling missing/malformed coordinates file

---

# Part 2: 2024 Season Game Data for Simulation

## Objective
Create a `game_data.csv` file with 2024 NFL season data for use by the simulation system.

## Background
- Simulation uses 2024 historical data (`simulation/sim_data/`)
- Currently has: `players_projected.csv`, `players_actual.csv`, `season_schedule.csv`, `team_data/`
- Need to add: `game_data.csv` with 2024 game information

## Output Location
- **File**: `simulation/sim_data/game_data.csv`
- Same format as the 2025 `data/game_data.csv`

## Data Source
- ESPN API with `dates=2024` parameter
- Open-Meteo for all weather data
- All 18 weeks of 2024 regular season

## Creation Process
```bash
# Run game data fetcher with 2024 season parameter
python run_game_data_fetcher.py --season 2024 --output simulation/sim_data/game_data.csv
```

## Expected Output
The 2024 `game_data.csv` should contain:
- All 272 regular season games (17 games × 32 teams / 2)
- Complete scores for all games (season is finished)
- Weather data from Open-Meteo for outdoor games
- Venue information (indoor, location)

## Example 2024 Data
```csv
week,home_team,away_team,temperature,gust,precipitation,home_team_score,away_team_score,indoor,neutral_site,country,city,state,date
1,KC,BAL,76,10,0.0,27,20,False,False,USA,Kansas City,MO,2024-09-05T00:20Z
1,PHI,GB,82,8,0.0,34,29,False,False,USA,Philadelphia,PA,2024-09-06T00:15Z
18,BUF,MIA,28,15,0.02,21,14,False,False,USA,Orchard Park,NY,2025-01-05T18:00Z
```

## New Files Summary

| File | Purpose | Location |
|------|---------|----------|
| `player-data-fetcher/game_data_fetcher.py` | Fetch game data from ESPN + weather from Open-Meteo | player-data-fetcher |
| `player-data-fetcher/game_data_models.py` | GameData Pydantic model | player-data-fetcher |
| `player-data-fetcher/coordinates_manager.py` | Dynamic coordinate lookup with geocoding API fallback | player-data-fetcher |
| `player-data-fetcher/coordinates.json` | Pre-populated NFL stadium coordinates, dynamically extended | player-data-fetcher |
| `data/game_data.csv` | 2025 season game data | Main data folder |
| `simulation/sim_data/game_data.csv` | 2024 season game data for simulation | Simulation data |

## Testing Requirements (Additional)
- Add unit tests in `tests/player-data-fetcher/test_game_data_models.py`
- Verify all 18 weeks are present for 2024
- Verify all games have scores (no empty scores for completed season)
- Verify weather is populated for outdoor games

---

## Open-Meteo API Details

### API Documentation
- [Open-Meteo Historical Weather API](https://open-meteo.com/en/docs/historical-weather-api)
- [Open-Meteo GitHub](https://github.com/open-meteo/open-meteo)

### API Endpoint
```
GET https://archive-api.open-meteo.com/v1/archive
```

### Required Parameters
| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `latitude` | float | Stadium latitude | `39.0489` |
| `longitude` | float | Stadium longitude | `-94.4839` |
| `start_date` | string | Game date (YYYY-MM-DD) | `2024-09-05` |
| `end_date` | string | Same as start_date | `2024-09-05` |
| `hourly` | string | Weather variables | `temperature_2m,wind_gusts_10m,precipitation` |
| `temperature_unit` | string | Unit for temperature | `fahrenheit` |
| `wind_speed_unit` | string | Unit for wind | `mph` |
| `precipitation_unit` | string | Unit for precipitation | `inch` |
| `timezone` | string | Local timezone | `America/Chicago` |

### Example API Call
```
https://archive-api.open-meteo.com/v1/archive?latitude=39.0489&longitude=-94.4839&start_date=2024-09-05&end_date=2024-09-05&hourly=temperature_2m,wind_gusts_10m,precipitation&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=America/Chicago
```

### Response Format
```json
{
  "hourly": {
    "time": ["2024-09-05T00:00", "2024-09-05T01:00", ...],
    "temperature_2m": [72.5, 71.2, ...],
    "wind_gusts_10m": [8.5, 10.2, ...],
    "precipitation": [0.0, 0.0, ...]
  }
}
```

### Rate Limiting
- Free tier: 10,000 calls/day (non-commercial use)
- No API key required
- No delay needed between requests

### Data Availability
- Historical data back to 1940
- **5-day delay** for recent games (Open-Meteo reanalysis data processing)
- For games less than 5 days old, weather may be temporarily unavailable

---

## Why Open-Meteo for All Weather Data

| Consideration | ESPN Weather | Open-Meteo |
|--------------|--------------|------------|
| Past games | NOT available | Available back to 1940 |
| Future games | Available (~1 week before) | Available (forecast) |
| Data type | % chance (precipitation) | Actual amounts (inches) |
| Consistency | Inconsistent with backfill | Always consistent |
| API key | Not required | Not required |
| Rate limit | ESPN rate limit applies | 10,000/day |

**Decision**: Use Open-Meteo for all weather to ensure:
1. Consistent data format across all games
2. No separate backfill script needed
3. Simpler implementation
4. Works for both 2024 simulation data and 2025 current data
