EXCEL TRADE VISUALIZER REORGANIZATION IDEAS
===========================================

Author: Kai Mizuno
Date: 2025-10-23

OBJECTIVE:
Reorganize the Excel file produced by the manual trade visualizer to make it clearer
what changed between both teams' scoring before and after the trade, and why the
scores changed.

===========================================
CURRENT EXCEL STRUCTURE
===========================================

The manual trade visualizer currently creates 4 sheets:

SHEET 1: SUMMARY
- Trade participants (My Team vs Opponent)
- Score improvements for both teams
- Lists players I give (with scores)
- Lists players I receive (with scores)

SHEET 2: INITIAL ROSTERS
- Side-by-side view of complete rosters BEFORE trade
- Columns: My Player/Pos/Team/Score | Their Player/Pos/Team/Score
- Total scores at bottom

SHEET 3: FINAL ROSTERS
- Side-by-side view of complete rosters AFTER trade
- Adds "Status" column (Received/Kept)
- Total scores at bottom
- Includes waiver recommendations if present

SHEET 4: DETAILED CALCULATIONS
- Shows scoring breakdown for trade-affected players only
- Separate rows for "Initial" and "Final" timing for each player
- Columns: Player, Position, Team, Owner, Timing, Final Score, plus all scoring
  components (ADP Rating, Player Rating, Performance, Matchup, Bye penalties, etc.)

===========================================
PROBLEMS WITH CURRENT DESIGN
===========================================

PROBLEM 1: HARD TO COMPARE BEFORE/AFTER
- Need to mentally switch between "Initial Rosters" and "Final Rosters" sheets
- No side-by-side before/after comparison for individual players

PROBLEM 2: DETAILED CALCULATIONS IS VERBOSE
- Each player has 2 rows (Initial + Final)
- Difficult to see what actually changed
- Must manually scan to find differences

PROBLEM 3: HIDDEN SCORE CHANGES
- Players who stay on roster but whose scores changed (e.g., bye penalties) are not
  highlighted
- Score deltas not calculated or displayed

PROBLEM 4: TRADED PLAYERS NOT EMPHASIZED
- Traded players mixed with kept players in Final Rosters
- No clear visual separation

PROBLEM 5: MISSING "WHY" EXPLANATIONS
- When a kept player's score changes, reason is buried in Detailed Calculations
- Bye week penalty changes not called out explicitly

===========================================
REORGANIZATION IDEAS
===========================================

-------------------------------------------
IDEA 1: ADD "TRADE IMPACT ANALYSIS" SHEET
-------------------------------------------

PURPOSE:
Clear before/after comparison focusing ONLY on what changed

STRUCTURE:
```
MY TEAM:
Player | Pos | Status | Initial Score | Final Score | Δ Score | Key Changes
--------------------------------------------------------------------------
PlayerA | RB | Traded Away | 285.5 | - | - | -
PlayerB | WR | Received    | - | 245.2 | - | New to roster
PlayerC | QB | Kept (Score Changed) | 310.0 | 305.0 | -5.0 | Bye penalty added

THEIR TEAM:
Player | Pos | Status | Initial Score | Final Score | Δ Score | Key Changes
--------------------------------------------------------------------------
PlayerD | WR | Traded Away | 255.0 | - | - | -
PlayerA | RB | Received    | - | 290.3 | - | New to roster (higher score in their context!)
PlayerE | TE | Kept (Score Changed) | 180.0 | 175.0 | -5.0 | Bye penalty removed
```

BENEFITS:
- Shows exactly what changed for each team
- Highlights score differences (e.g., PlayerA scores 285.5 on my team but 290.3 on
  their team)
- Clear "Key Changes" column explaining WHY scores changed

-------------------------------------------
IDEA 2: REORGANIZE DETAILED CALCULATIONS WITH SIDE-BY-SIDE COLUMNS
-------------------------------------------

CURRENT PROBLEM:
Each player has 2 rows (Initial/Final) - hard to compare

PROPOSED STRUCTURE:
```
Player | Pos | Owner | Status | Initial Score | Final Score | Δ Score |
Initial Bye Overlaps | Final Bye Overlaps | Δ Bye Overlaps | [other before/after columns]
```

BENEFITS:
- One row per player instead of two
- Easy to scan for changes (Δ columns)
- Highlights which scoring components changed

-------------------------------------------
IDEA 3: ADD COLOR CODING TO FINAL ROSTERS
-------------------------------------------

ENHANCEMENT:
Use background colors to highlight player status

COLOR SCHEME:
- GREEN: Received in trade
- RED: Traded away (show in separate section at bottom)
- YELLOW: Kept but score changed
- WHITE: Kept and score unchanged

BENEFITS:
- Immediate visual identification of trade impact
- No need to read "Status" column

-------------------------------------------
IDEA 4: ADD "SCORE CHANGE BREAKDOWN" SHEET
-------------------------------------------

PURPOSE:
Explain exactly WHY each player's score changed

STRUCTURE:
```
Player | Initial Bye Overlaps | Final Bye Overlaps | Bye Δ | Initial Injury |
Final Injury | Injury Δ | Total Δ
---------------------------------------------------------------------------
PlayerC | 0 same-pos | 2 same-pos | -10.5 pts | HEALTHY | HEALTHY | 0 pts | -10.5 pts
PlayerE | 2 same-pos | 0 same-pos | +10.5 pts | HEALTHY | HEALTHY | 0 pts | +10.5 pts
```

BENEFITS:
- Clearly shows which scoring components changed
- Helps understand bye week ripple effects

-------------------------------------------
IDEA 5: REORGANIZE SHEET ORDER
-------------------------------------------

CURRENT ORDER:
Summary → Initial Rosters → Final Rosters → Detailed Calculations

PROPOSED ORDER:
1. Summary (high-level overview)
2. Trade Impact Analysis (what changed - NEW)
3. Score Change Breakdown (why it changed - NEW)
4. Final Rosters (complete post-trade rosters)
5. Initial Rosters (move to end - less important once you understand the trade)
6. Detailed Calculations (raw data - for deep dives)

BENEFITS:
- Most important info first
- Tells a story: "What's the trade?" → "What changed?" → "Why did it change?"

-------------------------------------------
IDEA 6: ADD "TRADE SUMMARY METRICS" SECTION
-------------------------------------------

PURPOSE:
Key statistics at a glance

STRUCTURE (add to Summary sheet):
```
TRADE METRICS:
- Total value traded (points): 285.5 pts ↔ 255.0 pts
- Net advantage: My team (+30.5 pts)
- Players with score changes: 3 (2 on my team, 1 on their team)
- Bye week penalty changes: +2 overlaps on my team, -1 overlap on their team
```

BENEFITS:
- Quantifies the trade at a glance
- Highlights secondary effects (bye penalties)

-------------------------------------------
IDEA 7: SPLIT DETAILED CALCULATIONS INTO TWO SHEETS
-------------------------------------------

CURRENT PROBLEM:
One massive sheet with all scoring components

PROPOSED SPLIT:
- SHEET A: "Scoring Changes": Only shows components that CHANGED
- SHEET B: "Complete Scoring": Shows all components (current behavior)

BENEFITS:
- "Scoring Changes" sheet is much smaller and focused
- Power users can still access complete data

-------------------------------------------
IDEA 8: ADD VISUAL SCORE DELTA INDICATORS
-------------------------------------------

ENHANCEMENT:
Add symbols to make deltas more obvious

STRUCTURE:
```
Player | Initial Score | Final Score | Δ Score
----------------------------------------------
PlayerC | 310.0 | 305.0 | ▼ -5.0 pts
PlayerE | 180.0 | 185.0 | ▲ +5.0 pts
PlayerF | 250.0 | 250.0 | = 0.0 pts
```

BENEFITS:
- Arrows make direction of change immediately clear
- No need to parse +/- signs

===========================================
RECOMMENDED IMPLEMENTATION PRIORITY
===========================================

HIGH PRIORITY (biggest clarity improvements):
1. IDEA 1: Add "Trade Impact Analysis" sheet
2. IDEA 4: Add "Score Change Breakdown" sheet
3. IDEA 2: Reorganize Detailed Calculations with side-by-side columns

MEDIUM PRIORITY (nice visual enhancements):
4. IDEA 8: Add visual delta indicators (▲▼=)
5. IDEA 5: Reorganize sheet order
6. IDEA 6: Add trade summary metrics

LOWER PRIORITY (polish):
7. IDEA 3: Add color coding (requires openpyxl styling)
8. IDEA 7: Split Detailed Calculations into two sheets

===========================================
EXAMPLE: PROPOSED "TRADE IMPACT ANALYSIS" SHEET
===========================================

TRADE IMPACT SUMMARY

MY TEAM (Before → After: 1850.5 → 1865.3, +14.8 pts)
================================================================================
Status          | Player Name | Pos | Initial | Final | Δ Score | Reason for Change
----------------------------------------------------------------------------------
TRADED AWAY     | DeAndre Swift | RB | 285.5 | - | - | Sent to opponent
RECEIVED        | Stefon Diggs | WR | - | 245.2 | - | New (scored in my context)
KEPT (CHANGED)  | Lamar Jackson | QB | 310.0 | 305.0 | -5.0 | +2 bye overlaps (-10.5 pts)
KEPT (UNCHANGED)| Travis Kelce | TE | 275.0 | 275.0 | 0.0 | No change

THEIR TEAM (Before → After: 1820.0 → 1840.7, +20.7 pts)
================================================================================
Status          | Player Name | Pos | Initial | Final | Δ Score | Reason for Change
----------------------------------------------------------------------------------
TRADED AWAY     | Stefon Diggs | WR | 255.0 | - | - | Sent to me
RECEIVED        | DeAndre Swift | RB | - | 290.3 | - | New (scored in their context)
KEPT (CHANGED)  | Justin Jefferson | WR | 320.0 | 315.0 | -5.0 | +1 bye overlap (-5.25 pts)
KEPT (UNCHANGED)| Patrick Mahomes | QB | 305.0 | 305.0 | 0.0 | No change

KEY INSIGHTS:
- DeAndre Swift scores higher on their team (290.3) than on my team (285.5)
- Stefon Diggs scores lower on my team (245.2) than on their team (255.0)
- Both teams gained bye week overlaps (score penalties)

===========================================
KEY INSIGHT: SCORE CONTEXT MATTERS
===========================================

One of the most important insights from the proposed "Trade Impact Analysis" sheet is
that PLAYERS SCORE DIFFERENTLY IN DIFFERENT ROSTER CONTEXTS.

Example:
- DeAndre Swift scores 285.5 on MY team (where he adds bye overlaps)
- DeAndre Swift scores 290.3 on THEIR team (where he doesn't add bye overlaps)

This is CRITICAL information for trade evaluation, but it's currently HIDDEN in the
Excel output. Users must manually compare scores across sheets to discover this.

The proposed reorganization makes this insight IMMEDIATELY VISIBLE, helping users make
better trade decisions.

===========================================
TECHNICAL CONSIDERATIONS
===========================================

IMPLEMENTATION NOTES:

1. DATA AVAILABILITY:
   - All data needed is already available in TradeSnapshot and TradeSimTeam objects
   - my_original_team.scored_players has initial scores
   - trade.my_new_team.scored_players has final scores
   - Can calculate deltas by comparing these

2. SCORE CHANGE DETECTION:
   - Already implemented in _create_detailed_calculations_sheet (line 621-635)
   - Uses threshold: abs(original_player.score - new_player.score) > 0.01
   - Can reuse this logic for new sheets

3. REASON EXTRACTION:
   - ScoredPlayer.reason contains list of reason strings
   - Already have _parse_scoring_reasons() method (line 702-782)
   - Can extract specific components (bye overlaps, injury, etc.) for comparison

4. EXCEL FORMATTING:
   - Using pandas + openpyxl
   - Color coding requires openpyxl.styles (PatternFill, Font)
   - Already have _apply_sheet_formatting() helper (line 784-820)

===========================================
FILES TO MODIFY
===========================================

PRIMARY FILE:
- league_helper/trade_simulator_mode/trade_file_writer.py
  - Add new sheet creation methods:
    - _create_trade_impact_analysis_sheet()
    - _create_score_change_breakdown_sheet()
  - Modify _create_detailed_calculations_sheet() for side-by-side format
  - Update save_manual_trade_to_excel() to call new methods
  - Reorganize sheet creation order

TEST FILE:
- tests/league_helper/trade_simulator_mode/test_trade_file_writer.py
  - Add tests for new sheet creation methods
  - Update integration tests to verify new sheets exist
  - Test delta calculations
  - Test reason extraction for score changes

===========================================
NEXT STEPS
===========================================

1. Get user approval on which ideas to implement
2. Create questions file if clarification needed
3. Create TODO tracking file in updates/todo-files/
4. Implement changes following rules.txt protocol
5. Run unit tests after each major step
6. Move this file to updates/done/ when complete
